SELECT SUBTAB.ID_EMPRESA,
       SUBTAB.ID_OV,
       SUBTAB.DATA_CRIACAO_OV,
       SUBTAB.N_CONTRATO,
       SUBTAB.N_COTACAO,
       SUBTAB.DESC_REPRESENTANTE,
       SUBTAB.ID_TITULO,
       SUBTAB.N_LANCTO,
       SUBTAB.N_TITULO,
       SUBTAB.SERIE,
       SUBTAB.TIPO_TITULO,
       SUBTAB.TITULO_ANTECIPADO,
       SUBTAB.TIPO_RECEBIMENTO,
       SUBTAB.DATA_TITULO,
       SUBTAB.ID_PARCELA,
       SUBTAB.ID_CLIENTE,
       SUBTAB.CNPJ_CPF_PARCEIRO,
       SUBTAB.DESC_CLIENTE,
       SUBTAB.TIPO_PARCEIRO,
       IFSLAF.CUSTOMER_BR_TAX_INFO_API.GET_PERSON_TYPE(SUBTAB.ID_CLIENTE, IFSLAF.CUSTOMER_ORDER_API.GET_BILL_ADDR_NO(SUBTAB.ID_OV)) AS TIPO_ENTIDADE,
       IFSLAF.SALES_MARKET_API.GET_DESCRIPTION(IFSLAF.CUST_ORD_CUSTOMER_API.GET_MARKET_CODE(SUBTAB.ID_CLIENTE)) AS MERCADO,
       SUBTAB.ID_COND_PAGTO,
       SUBTAB.DESCR_COND_PAGTO,
       CASE WHEN SUBTAB.VALOR_BAIXA + SUBTAB.VALOR_LIQUIDO_RECEBIDO > 0 AND SUBTAB.VALOR_BAIXA + SUBTAB.VALOR_LIQUIDO_RECEBIDO < SUBTAB.VALOR_PARCELA THEN SUBTAB.VALOR_BAIXA + SUBTAB.VALOR_LIQUIDO_RECEBIDO ELSE SUBTAB.VALOR_PARCELA END AS VALOR_PARCELA,
       CASE WHEN SUBTAB.VALOR_BAIXA + SUBTAB.VALOR_LIQUIDO_RECEBIDO > 0 AND SUBTAB.VALOR_BAIXA + SUBTAB.VALOR_LIQUIDO_RECEBIDO < SUBTAB.VALOR_LIQUIDO_PARCELA THEN SUBTAB.VALOR_BAIXA + SUBTAB.VALOR_LIQUIDO_RECEBIDO ELSE SUBTAB.VALOR_LIQUIDO_RECEBIDO END AS VALOR_LIQUIDO_PARCELA,
       SUBTAB.VALOR_JUROS,
       SUBTAB.VALOR_MULTA,
       SUBTAB.DESCONTO_USADO,
       SUBTAB.VALOR_BAIXA,
       SUBTAB.CODIGO_BAIXA,
       SUBTAB.VALOR_RECEBIDO,
       SUBTAB.VALOR_LIQUIDO_RECEBIDO,
       SUBTAB.VALOR_ABERTO,
       SUBTAB.STATUS_TITULO,
       SUBTAB.TIPO_PAGAMENTO,
       SUBTAB.ID_PAGAMENTO,
       SUBTAB.DATA_PAGAMENTO,
       SUBTAB.DATA_LANCTO,
       SUBTAB.DATA_VENCIMENTO_ORIGINAL,
       SUBTAB.PROX_DT_VENCIMENTO,
       SUBTAB.DIA_VENCIMENTO_ORIGINAL,
       SUBTAB.DIAS_EM_ATRASO,
       SUBTAB.DIAS_EM_ATRASO_CALCULADO,
       SUBTAB.TIPO_RECEITA,
       SUBTAB.PERIODO_TITULO,
       SUBTAB.SITUACAO_RECEBIMENTO,
       SUBTAB.ID_CONTA_MOV,
       SUBTAB.ID_CODE_B_CR,
       SUBTAB.ID_CODE_C_SITE,
       SUBTAB.ID_CODE_D_NATUREZA,
       SUBTAB.ID_CODE_E_ATIVO,
       SUBTAB.ID_CODE_F_PROJETO,
       SUBTAB.ID_CODE_G_LINHA,
       SUBTAB.ID_CODE_H_APR_CUSTO,
       SUBTAB.ID_CODE_I_NEGOCIO,
       SUBTAB.DATA_CNPJ_JURIDICO,
       SUBTAB.NOTAS,
       SUBTAB.BLOCO_CODIGO
  FROM (SELECT A.COMPANY AS ID_EMPRESA,
               A.ORDER_REFERENCE AS ID_OV,
               IFSLAF.CUSTOMER_ORDER_API.GET_DATE_ENTERED(A.ORDER_REFERENCE) AS DATA_CRIACAO_OV,
               TO_CHAR(IFSLAF.CUSTOMER_ORDER_API.GET_C_AGREEMENT_ID(A.ORDER_REFERENCE)) AS N_CONTRATO,
               IFSLAF.CUSTOMER_ORDER_API.GET_QUOTATION_NO(A.ORDER_REFERENCE) AS N_COTACAO,
               IFSLAF.SALES_PART_SALESMAN_API.GET_NAME(IFSLAF.CUSTOMER_ORDER_API.GET_SALESMAN_CODE(A.ORDER_REFERENCE)) AS DESC_REPRESENTANTE,
               A.INVOICE_ID AS ID_TITULO,
               A.VOUCHER_NO_REF AS N_LANCTO,
               A.LEDGER_ITEM_ID AS N_TITULO,
               A.LEDGER_ITEM_SERIES_ID AS SERIE,
               IFSLAF.PAYMENT_PLAN_API.GET_C_INVOICE_TYPE_ID(A.COMPANY, A.INVOICE_ID, A.INSTALLMENT_ID) AS TIPO_TITULO,
               CASE NVL(A.ADV_INV, 'FALSE') WHEN 'FALSE' THEN 'Não' ELSE 'Sim' END AS TITULO_ANTECIPADO,
               CASE WHEN NVL(A.ADV_INV, 'FALSE') = 'TRUE' AND A.LEDGER_ITEM_SERIES_ID = 'CI' THEN 'ADIANTAMENTO' ELSE 'NOTA FISCAL' END AS TIPO_RECEBIMENTO,
               A.LEDGER_DATE AS DATA_TITULO,
               A.INSTALLMENT_ID AS ID_PARCELA,
               A.IDENTITY AS ID_CLIENTE,
               A.C_CNPJ AS CNPJ_CPF_PARCEIRO,
               A.NAME AS DESC_CLIENTE,
               IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(A.COMPANY, A.IDENTITY, 'Cliente') AS TIPO_PARCEIRO,
               IFSLAF.INVOICE_API.GET_PAY_TERM_ID(A.COMPANY, A.INVOICE_ID) AS ID_COND_PAGTO,
               IFSLAF.PAYMENT_TERM_API.GET_DESCRIPTION(A.COMPANY, IFSLAF.INVOICE_API.GET_PAY_TERM_ID(A.COMPANY, A.INVOICE_ID)) AS DESCR_COND_PAGTO,
               A.INV_AMOUNT AS VALOR_PARCELA,
               COALESCE((A.INV_AMOUNT - (SELECT Z.TAX_WITHHELD_CURR_AMOUNT
                                           FROM IFSLAF.ABSTRACT_PAYMENT_PLAN2 Z
                                          WHERE Z.INVOICE_ID = A.INVOICE_ID
                                            AND Z.INSTALLMENT_ID = A.INSTALLMENT_ID
                                            AND Z.PARTY_TYPE_DB = A.PARTY_TYPE_DB)),
                        A.INV_AMOUNT) AS VALOR_LIQUIDO_PARCELA,
               NVL(B.INTEREST_CURR_AMOUNT, 0) AS VALOR_JUROS,
               NVL(B.FINE_CURR_AMOUNT, 0) AS VALOR_MULTA,
               NVL(B.USED_DISCOUNT, 0) AS DESCONTO_USADO,
               NVL(B.WRITE_OFF_CURR_AMOUNT, 0) AS VALOR_BAIXA,
               B.WRITE_OFF_CODE AS CODIGO_BAIXA,
               NVL(DECODE(B.IS_NEW_LEDGER_ITEM, 'FALSE', B.PAID_AMOUNT - NVL(B.BOE_DISCOUNT_FEE, 0), B.PAID_AMOUNT), 0) AS VALOR_RECEBIDO,
               NVL(DECODE(B.IS_NEW_LEDGER_ITEM, 'FALSE', B.PAID_AMOUNT - NVL(B.BOE_DISCOUNT_FEE, 0), B.PAID_AMOUNT) + NVL(B.INTEREST_CURR_AMOUNT, 0) + NVL(B.FINE_CURR_AMOUNT, 0), 0) AS VALOR_LIQUIDO_RECEBIDO,
               A.OPEN_AMOUNT AS VALOR_ABERTO,
               A.CLIENT_INV_STATE AS STATUS_TITULO,
               B.PAYMENT_TYPE_CODE AS TIPO_PAGAMENTO,
               B.PAYMENT_ID AS ID_PAGAMENTO,
               B.PAY_DATE AS DATA_PAGAMENTO,
               B.VOUCHER_DATE AS DATA_LANCTO,
               A.C_DUE_DATE_ORG AS DATA_VENCIMENTO_ORIGINAL,
               A.DUE_DATE AS PROX_DT_VENCIMENTO,
               TO_CHAR(A.C_DUE_DATE_ORG, 'Day', 'NLS_DATE_LANGUAGE=PORTUGUESE') AS DIA_VENCIMENTO_ORIGINAL,
               IFSLAF.PAYMENT_PLAN_API.GET_C_LATE_DAYS_CUST(A.COMPANY, A.INVOICE_ID, A.INSTALLMENT_ID) AS DIAS_EM_ATRASO,
               TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END AS DIAS_EM_ATRASO_CALCULADO,
               CASE WHEN IFSLAF.PAYMENT_PLAN_API.GET_C_CNPJ_JURIDICAL(A.COMPANY, A.INVOICE_ID, A.INSTALLMENT_ID) = 'TRUE' OR IFSLAF.PAYMENT_PLAN_API.GET_C_INVOICE_TYPE_ID(A.COMPANY, A.INVOICE_ID, A.INSTALLMENT_ID) = 'TÍTULO JURÍDICO' THEN 'JURÍDICO' ELSE 'FINANCEIRO' END AS TIPO_RECEITA,
               CASE WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END <= 0 THEN '1 - Em dia'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 31 THEN '2 - Vencidos até 30 dias'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 61 THEN '3 - Vencidos entre 31 e 60 dias'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 91 THEN '4 - Vencidos entre 61 e 90 dias'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 121 THEN '5 - Vencidos entre 91 e 120 dias'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 181 THEN '6 - Vencidos entre 121 e 180 dias'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 366 THEN '7 - Vencidos entre 180 e 365 dias'
                    ELSE '8 - Vencidos acima de 365 dias'
               END AS PERIODO_TITULO,
               CASE WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 0 THEN 'Antecipado'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END = 0 THEN 'Em dia'
                    WHEN TRUNC(COALESCE(B.PAY_DATE, SYSDATE)) - TRUNC(A.C_DUE_DATE_ORG) - CASE WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 1 THEN 1 WHEN TO_CHAR(A.C_DUE_DATE_ORG, 'D') = 7 THEN 2 ELSE 0 END < 31 THEN 'Recuperação de atraso'
                    ELSE 'Recuperação de inadimplência'
               END AS SITUACAO_RECEBIMENTO,
               IFSLAF.PAYMENT_PER_CURRENCY_API.GET_SHORT_NAME(B.COMPANY, B.SERIES_ID, B.PAYMENT_ID, B.CURRENCY) AS ID_CONTA_MOV,
               A.CODE_B AS ID_CODE_B_CR,
               A.CODE_C AS ID_CODE_C_SITE,
               A.CODE_D AS ID_CODE_D_NATUREZA,
               A.CODE_E AS ID_CODE_E_ATIVO,
               A.CODE_F AS ID_CODE_F_PROJETO,
               A.CODE_G AS ID_CODE_G_LINHA,
               A.CODE_H AS ID_CODE_H_APR_CUSTO,
               A.CODE_I AS ID_CODE_I_NEGOCIO,
               IFSLAF.PAYMENT_PLAN_API.GET_C_CNPJ_JURIDICAL_DATE(A.COMPANY, A.INVOICE_ID, A.INSTALLMENT_ID) AS DATA_CNPJ_JURIDICO,
               A.NOTE AS NOTAS,
               'A' AS BLOCO_CODIGO
          FROM IFSLAF.CUST_INV_INTEREST_FINE_QRY A
          LEFT JOIN IFSLAF.LEDGER_TRANSACTION_CU_QRY B ON (A.COMPANY = B.COMPANY AND A.IDENTITY = B.IDENTITY AND A.PARTY_TYPE_DB = B.PARTY_TYPE_DB AND A.LEDGER_ITEM_ID = B.LEDGER_ITEM_ID AND A.LEDGER_ITEM_SERIES_ID = B.LEDGER_ITEM_SERIES_ID AND A.LEDGER_ITEM_VERSION = B.LEDGER_ITEM_VERSION AND A.INSTALLMENT_ID = B.INSTALLMENT_ID AND B.ROLLEDBACK = 'FALSE' AND B.PAYMENT_TYPE_CODE_DB IN ('CUSTOFF', 'CUSTPAY', 'CUSTSUPPOFF'))
         WHERE (A.LEDGER_ITEM_SERIES_ID IN ('CD', 'CI', 'EX'))
           AND (A.INV_AMOUNT <> 0)

         UNION ALL

        SELECT NID.COMPANY AS ID_EMPRESA,
               NULL AS ID_OV,
               NULL AS DATA_CRIACAO_OV,
               NID.CONTRACT_NO AS N_CONTRATO,
               NULL AS N_COTACAO,
               NULL AS DESC_REPRESENTANTE,
               NULL AS ID_TITULO,
               IPN.VOUCHER_NO AS N_LANCTO,
               NID.LEDGER_ITEM_ID AS N_TITULO,
               NID.LEDGER_ITEM_SERIES_ID AS SERIE,
               NULL AS TIPO_TITULO,
               CASE NVL(NID.ADV_INV, 'FALSE') WHEN 'FALSE' THEN 'Não' ELSE 'Sim' END AS TITULO_ANTECIPADO,
               'NÃO IDENTIFICADO' AS TIPO_RECEBIMENTO,
               IPN.VOUCHER_DATE AS DATA_TITULO,
               NID.INSTALLMENT_ID AS ID_PARCELA,
               NID.IDENTITY AS ID_CLIENTE,
               NULL AS CNPJ_CPF_PARCEIRO,
               IFSLAF.INVOICE_LIBRARY_API.GET_IDENTITY_NAME_DB(NID.CHILD_COMPANY, NID.IDENTITY, NID.PARTY_TYPE_DB) AS DESC_CLIENTE,
               'Externo' AS TIPO_PARCEIRO,
               NULL AS ID_COND_PAGTO,
               NULL AS DESCR_COND_PAGTO,
               NID.CURR_AMOUNT AS VALOR_PARCELA,
               NID.CURR_AMOUNT AS VALOR_LIQUIDO_PARCELA,
               0 AS VALOR_JUROS,
               0 AS VALOR_MULTA,
               NID.DISC_CURR_AMOUNT AS DESCONTO_USADO,
               NID.PAYMENT_AMOUNT AS VALOR_BAIXA,
               NULL AS CODIGO_BAIXA,
               NID.CURR_AMOUNT AS VALOR_RECEBIDO,
               NID.CURR_AMOUNT AS VALOR_LIQUIDO_RECEBIDO,
               0 AS VALOR_ABERTO,
               NULL AS STATUS_TITULO,
               'Pagamento Cliente' AS TIPO_PAGAMENTO,
               NID.PAYMENT_ID AS ID_PAGAMENTO,
               IPN.PAY_DATE AS DATA_PAGAMENTO,
               IPN.VOUCHER_DATE AS DATA_LANCTO,
               NID.DUE_DATE AS DATA_VENCIMENTO_ORIGINAL,
               NID.DUE_DATE AS PROX_DT_VENCIMENTO,
               TO_CHAR(NID.DUE_DATE, 'Day', 'NLS_DATE_LANGUAGE=PORTUGUESE') AS DIA_VENCIMENTO_ORIGINAL,
               0 AS DIAS_EM_ATRASO,
               0 AS DIAS_EM_ATRASO_CALCULADO,
               NULL AS TIPO_RECEITA,
               '1 - Em dia' AS PERIODO_TITULO,
               'Em dia' AS SITUACAO_RECEBIMENTO,
               IFSLAF.PAYMENT_PER_CURRENCY_API.GET_SHORT_NAME(NID.COMPANY, NID.SERIES_ID, NID.PAYMENT_ID, NID.CURRENCY) AS ID_CONTA_MOV,
               NID.CODE_B AS ID_CODE_B_CR,
               NID.CODE_C AS ID_CODE_C_SITE,
               NID.CODE_D AS ID_CODE_D_NATUREZA,
               NID.CODE_E AS ID_CODE_E_ATIVO,
               NID.CODE_F AS ID_CODE_F_PROJETO,
               NID.CODE_G AS ID_CODE_G_LINHA,
               NID.CODE_H AS ID_CODE_H_APR_CUSTO,
               NID.CODE_I AS ID_CODE_I_NEGOCIO,
               NULL AS DATA_CNPJ_JURIDICO,
               NID.NOTE AS NOTAS,
               'B' AS BLOCO_CODIGO
          FROM IFSLAF.INTERCOMPANY_TRANSACTION_QRY NID
          LEFT JOIN IFSLAF.INTER_PAYMENT_UNION IPN ON (NID.COMPANY = IPN.COMPANY AND NID.SERIES_ID = IPN.SERIES_ID AND NID.PAYMENT_ID = IPN.PAYMENT_ID)
         WHERE (NID.CURR_AMOUNT > 0)
           AND (NID.IS_NEW_LEDGER_ITEM = 'TRUE')
           AND (NID.IS_PARKED = 'TRUE')
           AND (NID.LEDGER_ITEM_SERIES_ID = 'CUPOA')
           AND (NID.PARTY_TYPE_DB = 'COMPANY')
           AND (NID.ROLLEDBACK = 'FALSE')

        UNION ALL

        SELECT NID.COMPANY AS ID_EMPRESA,
               DET.ORDER_REFERENCE AS ID_OV,
               IFSLAF.CUSTOMER_ORDER_API.GET_DATE_ENTERED(DET.ORDER_REFERENCE) AS DATA_CRIACAO_OV,
               IFSLAF.ON_ACCOUNT_LEDGER_ITEM_API.GET_CONTRACT_NO(NID.COMPANY, NID.IDENTITY, NID.PARTY_TYPE_DB, NID.LEDGER_ITEM_SERIES_ID, NID.LEDGER_ITEM_ID, NID.LEDGER_ITEM_VERSION) AS N_CONTRATO,
               NULL AS N_COTACAO,
               NULL AS DESC_REPRESENTANTE,
               NULL AS ID_TITULO,
               DET.VOUCHER_NO AS N_LANCTO,
               NID.LEDGER_ITEM_ID AS N_TITULO,
               NID.LEDGER_ITEM_SERIES_ID AS SERIE,
               NULL AS TIPO_TITULO,
               CASE NVL(DET.ADV_INV, 'FALSE') WHEN 'FALSE' THEN 'Não' ELSE 'Sim' END AS TITULO_ANTECIPADO,
               'ADIANTAMENTO' AS TIPO_RECEBIMENTO,
               DET.LEDGER_DATE AS DATA_TITULO,
               NID.INSTALLMENT_ID AS ID_PARCELA,
               NID.IDENTITY AS ID_CLIENTE,
               NULL AS CNPJ_CPF_PARCEIRO,
               NID.NAME AS DESC_CLIENTE,
               'Externo' AS TIPO_PARCEIRO,
               NULL AS ID_COND_PAGTO,
               NULL AS DESCR_COND_PAGTO,
               NID.PAID_AMOUNT AS VALOR_PARCELA,
               NID.PAID_AMOUNT AS VALOR_LIQUIDO_PARCELA,
               0 AS VALOR_JUROS,
               0 AS VALOR_MULTA,
               NID.USED_DISCOUNT AS DESCONTO_USADO,
               NID.PAYMENT_AMOUNT AS VALOR_BAIXA,
               NULL AS CODIGO_BAIXA,
               NID.PAID_AMOUNT AS VALOR_RECEBIDO,
               NID.PAID_AMOUNT AS VALOR_LIQUIDO_RECEBIDO,
               0 AS VALOR_ABERTO,
               NULL AS STATUS_TITULO,
               'Pagamento Cliente' AS TIPO_PAGAMENTO,
               NID.PAYMENT_ID AS ID_PAGAMENTO,
               DET.DUE_DATE AS DATA_PAGAMENTO,
               NID.VOUCHER_DATE AS DATA_LANCTO,
               DET.DUE_DATE AS DATA_VENCIMENTO_ORIGINAL,
               DET.DUE_DATE AS PROX_DT_VENCIMENTO,
               TO_CHAR(DET.DUE_DATE, 'Day', 'NLS_DATE_LANGUAGE=PORTUGUESE') AS DIA_VENCIMENTO_ORIGINAL,
               0 AS DIAS_EM_ATRASO,
               0 AS DIAS_EM_ATRASO_CALCULADO,
               NULL AS TIPO_RECEITA,
               '1 - Em dia' AS PERIODO_TITULO,
               'Em dia' AS SITUACAO_RECEBIMENTO,
               IFSLAF.PAYMENT_PER_CURRENCY_API.GET_SHORT_NAME(NID.COMPANY, NID.SERIES_ID, NID.PAYMENT_ID, NID.CURRENCY) AS ID_CONTA_MOV,
               DET.CODE_B AS ID_CODE_B_CR,
               DET.CODE_C AS ID_CODE_C_SITE,
               DET.CODE_D AS ID_CODE_D_NATUREZA,
               DET.CODE_E AS ID_CODE_E_ATIVO,
               DET.CODE_F AS ID_CODE_F_PROJETO,
               DET.CODE_G AS ID_CODE_G_LINHA,
               DET.CODE_H AS ID_CODE_H_APR_CUSTO,
               DET.CODE_I AS ID_CODE_I_NEGOCIO,
               IFSLAF.PAYMENT_PLAN_API.GET_C_CNPJ_JURIDICAL_DATE(NID.COMPANY, NID.INVOICE_ID, NID.INSTALLMENT_ID) AS DATA_CNPJ_JURIDICO,
               IFSLAF.PAYMENT_PLAN_API.GET_C_INSTALLMENT_NOTES(NID.COMPANY, NID.INVOICE_ID, NID.INSTALLMENT_ID) AS NOTAS,
               'C' AS BLOCO_CODIGO
          FROM IFSLAF.LEDGER_TRANSACTION_CU_QRY NID
         INNER JOIN IFSLAF.LEDGER_ITEM_CU_DET_QRY DET ON (NID.IDENTITY = DET.IDENTITY AND NID.COMPANY = DET.COMPANY AND NID.PARTY_TYPE = DET.PARTY_TYPE AND NID.LEDGER_ITEM_SERIES_ID = DET.LEDGER_ITEM_SERIES_ID AND NID.LEDGER_ITEM_ID = DET.LEDGER_ITEM_ID AND NID.LEDGER_ITEM_VERSION = DET.LEDGER_ITEM_VERSION)
         WHERE (NID.ROLLEDBACK = 'FALSE')
           AND (NID.PAYMENT_TYPE_CODE_DB IN ('CUSTOFF', 'CUSTPAY', 'CUSTSUPPOFF'))
           AND (NID.LEDGER_ITEM_SERIES_ID = 'CUPOA')
           AND (NID.IS_NEW_LEDGER_ITEM = 'TRUE')
           AND (NID.ROLLEDBACK = 'FALSE')
       ) SUBTAB
