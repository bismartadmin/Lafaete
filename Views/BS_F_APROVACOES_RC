select COMPANY ID_EMPRESA,
       IFSLAF.Purchase_Req_Line_API.Get_Contract(REQUISITION_NO,LINE_NO,RELEASE_NO) ID_SITE,
       CF$_DESC_SITE DESC_SITE,
       REQUISITION_NO N_REQUISICAO,
       ROUTE N_ETAPA,
       IFSLAF.PURCHASE_REQUISITION_API.Get_Requisitioner_Code(REQUISITION_NO) ID_REQUISITANTE,
       IFSLAF.PURCHASE_REQUISITIONER_API.Get_Requisitioner(IFSLAF.PURCHASE_REQUISITION_API.Get_Requisitioner_Code(REQUISITION_NO)) DESC_REQUISITANTE,
       IFSLAF.PURCHASE_REQUISITION_API.Get_Order_Code(REQUISITION_NO) COD_ORDEM,
       LINE_NO N_LINHA,
       RELEASE_NO N_LIBERACAO,
       IFSLAF.PURCHASE_REQ_LINE_PART_API.Get_Part_No(REQUISITION_NO,LINE_NO,RELEASE_NO) ID_MATERIAL,
       IFSLAF.PURCHASE_REQ_LINE_API.Get_Description(requisition_no,line_no,RELEASE_NO) DESC_MATERIAL,
       AUTHORIZE_ID ID_AUTORIZADOR,
       IFSLAF.PURCHASE_AUTHORIZER_API.Get_Name(AUTHORIZE_ID) DESC_AUTORIZADOR,
       AUTHORIZE_GROUP_ID ID_GRP_AUTORIZACAO,
       IFSLAF.PURCH_AUTHORIZE_GROUP_API.Get_Description(COMPANY,AUTHORIZE_GROUP_ID) DESC_GRP_AUTORIZACAO,
       BUYER_CODE ID_COMPRADOR,
       IFSLAF.PURCHASE_BUYER_API.Get_Name(buyer_code) DESC_COMPRADOR,
       PROJECT_ROLE_ID ID_FUNCAO_PROJETO,
       IFSLAF.PROJECT_ROLE_BASIC_API.Get_Description(company,PROJECT_ROLE_ID) DESC_FUNCAO_PROJETO,
       ORG_CODE ID_ORGANIZACAO,
       IFSLAF.COMPANY_ORG_API.Get_Org_Name(company,ORG_CODE) DESC_ORGANIZACAO,
       POS_CODE ID_POSICAO,
       IFSLAF.COMPANY_POSITION_API.Get_Position_Title(company,POS_CODE) DESC_POSICAO,
       AUTHORIZATION_ROLE_TYPE TIPO_AUTORIZACAO,
       IFSLAF.Purchase_Req_Line_API.Get_Wanted_Receipt_Date(REQUISITION_NO,LINE_NO,RELEASE_NO) DATA_RECEBIMENTO_DESEJADA,
       IFSLAF.PURCHASE_REQ_LINE_PART_API.Get_Qty_In_Purch_Unit(REQUISITION_NO, LINE_NO, RELEASE_NO) QTDE_COMPRA,
       IFSLAF.PURCHASE_REQ_LINE_API.Get_Buy_Unit_Meas(requisition_no,line_no,RELEASE_NO) UM_COMPRA,
       IFSLAF.PURCHASE_REQ_LINE_API.Get_Line_Total(requisition_no,line_no,RELEASE_NO) VALOR_LIQ_BASE,
       NVL(VENDOR_NO,IFSLAF.PURCHASE_REQ_LINE_API.Get_Vendor_No(REQUISITION_NO,LINE_NO,RELEASE_NO)) ID_FORNECEDOR,
       DECODE(VENDOR_NO, NULL, IFSLAF.SUPPLIER_API.Get_Vendor_Name(IFSLAF.PURCHASE_REQ_LINE_API.Get_Vendor_No(REQUISITION_NO,LINE_NO,RELEASE_NO)),IFSLAF.SUPPLIER_API.Get_Vendor_Name(VENDOR_NO))  DESC_FORNECEDOR,
       SIGNATURE_ID ID_ASSINATURA,
       IFSLAF.Fnd_User_API.Get_Description(SIGNATURE_ID) DESC_ASSINATURA,
       DATE_APPROVED DATA_AUTORIZACAO,
       REVOKED_SIGNATURE_ID ID_REVOGADA,
       Decode(IFSLAF.Fnd_User_API.Get_Description(REVOKED_SIGNATURE_ID),NULL,REVOKED_SIGNATURE_ID,IFSLAF.Fnd_User_API.Get_Description(REVOKED_SIGNATURE_ID)) DESC_REVOGADA,
       REVOKED_DATE DATA_REVOGADA,
       DECODE( NOTE_TEXT, NULL, 'FALSE', 'TRUE' ) POSSUI_NOTA,
       NOTE_TEXT NOTA,
       SEQUENCE_NO ID_SEQUENCIA,
       APPROVAL_RULE REGRA_AUTORIZACAO,
       PURCH_AUTH_RULE_ORIGIN ORIGEM_REGRA_AUTORIZACAO,
       TARGET_DAYS DIAS_DESTINO,
       TARGET_DATE DATA_ALVO,
       IFSLAF.Purchase_Req_Line_API.Get_Project_id(requisition_no,line_no,release_no) ID_PROJETO,
       IFSLAF.Project_API.Get_Name(IFSLAF.Purchase_Req_Line_API.Get_Project_id(requisition_no,line_no,release_no)) DESC_PROJETO,
       IFSLAF.Activity_API.Get_Sub_Project_Id(IFSLAF.Purchase_Req_Line_API.Get_Activity_Seq(requisition_no,line_no,release_no)) ID_SUB_PROJETO,
       IFSLAF.Activity_API.Get_Sub_Project_Description(IFSLAF.Purchase_Req_Line_API.Get_Activity_Seq(requisition_no,line_no,release_no)) DESC_SUB_PROJETO,
       IFSLAF.Activity_API.Get_Activity_No(IFSLAF.Purchase_Req_Line_API.Get_Activity_Seq(requisition_no,line_no,release_no)) ID_ATIVIDADE,
       IFSLAF.Activity_API.Get_Description(IFSLAF.Purchase_Req_Line_API.Get_Activity_Seq(requisition_no,line_no,release_no)) DESC_ATIVIDADE,
       IFSLAF.Purchase_Req_Line_API.Get_Activity_Seq(requisition_no,line_no,release_no) SEQ_ATIV,
       IFSLAF.Purchase_Req_Line_API.Get_Purchase_Code(requisition_no,line_no,release_no) CODIGO_COMPRA,
       IFSLAF.Purchase_Code_API.Get_Description(IFSLAF.Purchase_Req_Line_API.Get_Purchase_Code(requisition_no,line_no,release_no)) DESC_CODIGO_COMPRA,
       FORWARDED_BY ENCAMINHADO_POR,
       FORWARDED_TO ENCAMINHADO_PARA,
       FORWARDED_DATE DATA_EXPEDICAO,
       CF$_APR_CUSTO ID_APR_CUSTO,
       CF$_DESC_APR_CUSTO DESC_APR_CUSTO,
       CF$_ATIVO_FIXO ID_ATIVO_FIXO,
       CF$_DESC_ATIVO_FIXO DESC_ATIVO_FIXO,
       CF$_CR ID_CR,
       CF$_DESC_CR DESC_CR,
       CF$_NEGOCIO ID_NEGOCIO,
       CF$_DESC_NEGOCIO DESC_NEGOCIO,
       CF$_NATUREZA ID_NATUREZA,
       CF$_DESCNATURERZA DESC_NATUREZA,
       CF$_LAST_SALE DATA_ULTIMA_COMPRA,
       CF$_NOTE_TEXT_REQUISITION NOTAS_REQUISICAO,
       CF$_QTD_INVENTORY QTDE_EM_ESTOQUE
from IFSLAF.PURCH_REQ_LINE_APPROVAL_CFV appline
where signature_id IS NULL AND EXISTS 
 (SELECT 1
 FROM IFSLAF.purchase_req_line reqline
 WHERE appline.requisition_no = reqline.requisition_no
 AND appline.line_no = reqline.line_no
 AND appline.release_no = reqline.release_no
 AND appline.signature_id IS NULL
 AND reqline.template_id IS NOT NULL
 AND reqline.objstate IN ('Released', 'Partially Authorized', 'Request Created') )
