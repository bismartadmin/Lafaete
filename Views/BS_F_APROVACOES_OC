SELECT POA.ORDER_NO N_ORDEM,
       DECODE(POA.CHG_ORDER_NO, '*', 'TRUE', 'FALSE' ) AUTORIZACAO_ORIGINAL,
       POA.CHG_ORDER_NO N_ORDEM_ALTERACAO,
       POA.COMPANY ID_EMPRESA, --ACRECIMO DO PREFIXO ID_.
       IFSLAF.COMPANY_API.get_NAME(POA.COMPANY) AS DESC_EMPRESA, -- CONCLUSÃO DO CAMPO DE DESCIÇÃO DA EMPRESA. 
       IFSLAF.PURCHASE_ORDER_API.Get_Vendor_No(ORDER_NO) ID_FORNECEDOR,
       IFSLAF.SUPPLIER_API.Get_Vendor_Name(IFSLAF.PURCHASE_ORDER_API.Get_Vendor_No(ORDER_NO)) DESC_FORNECEDOR,
       POA.ROUTE N_ETAPA,
       COALESCE(POA.AUTHORIZE_ID,D.authorize_id) ID_AUTORIZADOR,
       ifslaf.COMM_METHOD_API.Get_Value('PERSON', COALESCE(POA.AUTHORIZE_ID,D.authorize_id), IFSLAF.Comm_Method_Code_API.Decode('E_MAIL'), 1,'')  EMAIL_APROVADOR,
       COALESCE(IFSLAF.PURCHASE_AUTHORIZER_API.Get_Name(POA.AUTHORIZE_ID),
       IFSLAF.PURCHASE_AUTHORIZER_API.Get_Name(D.AUTHORIZE_ID)) DESC_AUTORIZADOR,
       POA.AUTHORIZE_GROUP_ID ID_GRUPO_AUTORIZACAO,
       IFSLAF.PURCH_AUTHORIZE_GROUP_API.Get_Description(POA.COMPANY,POA.AUTHORIZE_GROUP_ID) DESC_GRP_AUTORIZACAO,
       POA.PROJECT_ROLE_ID ID_FUNCAO_PROJETO,
       IFSLAF.PROJECT_ROLE_BASIC_API.Get_Description(POA.company,POA.PROJECT_ROLE_ID) DESC_FUNCAO_PROJETO,
       POA.ORG_CODE ID_ORG,
       IFSLAF.COMPANY_ORG_API.Get_Org_Name(POA.company,POA.ORG_CODE) DESC_ORG,
       POA.POS_CODE ID_POSICAO,
       IFSLAF.COMPANY_POSITION_API.Get_Position_Title(POA.company,POA.POS_CODE) DESC_POSICAO,
       POA.BUYER_CODE ID_COMPRADOR,
       IFSLAF.PURCHASE_BUYER_API.Get_Name(BUYER_CODE) DESC_COMPRADOR,
       POA.AUTHORIZATION_ROLE_TYPE FUNCAO_AUTORIZACAO,
       POA.APPROVER_SIGN ID_ASSINATURA,
       decode(IFSLAF.Fnd_User_API.Get_Description(APPROVER_SIGN),NULL,APPROVER_SIGN,IFSLAF.Fnd_User_API.Get_Description(APPROVER_SIGN)) DESC_ASSINATURA,
       POA.DATE_APPROVED DATA_AUTORIZACAO,
       POA.REVOKED_SIGNATURE_ID ID_REVOGACAO,
       Decode(IFSLAF.Fnd_User_API.Get_Description(REVOKED_SIGNATURE_ID),NULL,REVOKED_SIGNATURE_ID,IFSLAF.Fnd_User_API.Get_Description(REVOKED_SIGNATURE_ID)) DESC_REVOGACAO,
       POA.REVOKED_DATE DATA_REVOGACAO,
       decode( POA.NOTE_TEXT, NULL, 'FALSE', 'TRUE' ) NOTA_EXISTE,
       POA.NOTE_TEXT NOTA,
       POA.PURCH_AUTH_RULE_ORIGIN ORIGEM_REGRA_AUTORIZACAO,
       POA.APPROVAL_RULE ID_REGRA_AUTORIZACAO,
       IFSLAF.PUR_APPROVAL_RULE_API.Get_Description(POA.APPROVAL_RULE) DESC_REGRA_AUTORIZACAO,
       POA.TEMPLATE_ID ID_ROTEIRO_AUTORIZACAO,
       POA.SEQUENCE_NO ID_SEQUENCIAL,
       POA.TARGET_DAYS DIAS_DESTINO,
       POA.TARGET_DATE DATA_ALVO,
       IFSLAF.Purchase_Order_API.Get_Project_Id(order_no) ID_PROJETO,
       IFSLAF.Project_API.Get_Name(IFSLAF.Purchase_Order_API.Get_Project_Id(order_no)) DESC_PROJETO,
       IFSLAF.Purchase_Order_API.Get_Purchase_Code(order_no) ID_CODIGO_COMPRA,
       IFSLAF.Purchase_Code_API.Get_Description(IFSLAF.Purchase_Order_API.Get_Purchase_Code(order_no)) DESC_CODIGO_COMPRA,
       POA.FORWARDED_BY ENCAMINHADO_POR,
       POA.FORWARDED_TO ENCAMINHADO_PARA,
       POA.FORWARDED_DATE DATA_EXPEDICAO,
       POA.CF$_VALOR_BRUTO_ANTERIOR VALOR_BRUTO_ANTERIOR,
       POA.CF$_ALTERACAO_VALOR_BRUTO ALTERACAO_VALOR_BRUTO,
       POA.CF$_VALOR_BRUTO_ATUAL VALOR_BRUTO_ATUAL,
       POA.CF$_CODE_I ID_CODE_I,
       POA.CF$_DESC_CODE_I DESC_CODE_I,
       POA.CF$_CONTRACT ID_SITE,
       POA.CF$_CONTRACT_DESCRIPTION DESC_SITE
       from IFSLAF.PURCHASE_ORDER_APPROVAL_CFV poa
       JOIN IFSLAF.PUR_APPROVAL_RULE C ON POA.company = C.company AND POA.TEMPLATE_ID = C.template_id
       LEFT JOIN ifslaf.PURCH_AUTHORIZE_GROUP_LINE d ON POA.company = d.company AND POA.authorize_group_id = d.authorize_group_id
       where IFSLAF.Purchase_Order_API.Get_Objstate__(order_no) != 'Cancelled'
       AND (chg_order_no = '*' OR (chg_order_no != '*'
       AND IFSLAF.Purch_Chg_Ord_API.Get_Objstate(order_no, chg_order_no) != 'Cancelled'))
       AND APPROVER_SIGN IS NULL
       AND route IN (SELECT MIN(a.route)
 	     FROM IFSLAF.purchase_order_approval a
       WHERE a.order_no = poa.order_no
       AND a.chg_order_no = poa.chg_order_no
       AND a.approver_sign IS NULL)
       AND approver_sign IS NULL
