SELECT SUBTAB.TIPO_MOVIMENTO AS TIPO_MOVIMENTO,
       SUBTAB.FISCAL_NOTE_ID AS ID_NOTA_FISCAL,
       SUBTAB.FISCAL_NOTE_NO AS N_NOTA_FISCAL,
       SUBTAB.DOCUMENT_NO AS TIPO_DOCUMENTO,
       SUBTAB.INVOICE_ID AS ID_TITULO,
       SUBTAB.N_TITULO AS N_TITULO,
       SUBTAB.VOUCHER_NO_REF AS N_LANCAMENTO,
       CASE SUBTAB.FISCAL_NOTE_TYPE
            WHEN 'Devolução de Cliente' THEN 'Receita'
            WHEN 'Ordem de Venda' THEN 'Receita'
            ELSE 'Despesa'
       END AS TIPO_NOTA,
       SUBTAB.ORDER_NO AS ID_OC_OV,
       SUBTAB.TIPO_ORDEM AS TIPO_OV,
       SUBTAB.COD_VENDEDOR AS ID_REPRESENTANTE,
       SUBTAB.SALESMAN_NAME AS DESC_REPRESENTANTE,
       SUBTAB.CODIGO_CLIENTE AS ID_PARCEIRO,
       SUBTAB.DELIVERY_CNPJ_CPF AS CNPJ_CPF_PARCEIRO,
       SUBTAB.DELIVERY_NAME AS DESC_PARCEIRO,
       NVL(SUBTAB.IDENTITY_TYPE, 'Externo') AS TIPO_PARCEIRO,
       NVL(IFSLAF.CUSTOMER_ORDER_API.GET_MARKET_CODE(SUBTAB.ORDER_NO), IFSLAF.CUST_ORD_CUSTOMER_API.GET_MARKET_CODE(SUBTAB.CODIGO_CLIENTE)) AS ID_MERCADO,
       IFSLAF.SALES_MARKET_API.GET_DESCRIPTION(NVL(IFSLAF.CUSTOMER_ORDER_API.GET_MARKET_CODE(SUBTAB.ORDER_NO), IFSLAF.CUST_ORD_CUSTOMER_API.GET_MARKET_CODE(SUBTAB.CODIGO_CLIENTE))) AS DESC_MERCADO,
       SUBTAB.CREATION_DATE AS DATA_CRIACAO,
       SUBTAB.EMISSION_DATE AS DATA_EMISSAO,
       SUBTAB.ENTRY_DATE AS DATA_LANCTO,
       SUBTAB.COMPANY AS ID_EMPRESA,
       SUBTAB.CONTRACT AS ID_SITE,
       SUBTAB.CIDADE_OBRA || '-' || SUBTAB.ESTADO_OBRA AS CIDADE_UF,
       SUBTAB.OPERATION_ID AS ID_OPERACAO,
       IFSLAF.OPERATION_API.GET_DESCRIPTION(SUBTAB.OPERATION_ID) AS OPERACAO_FISCAL,
       SUBTAB.PART_NO AS ID_MATERIAL,
       SUBTAB.PRODUCT_DESCRIPTION AS DESC_MATERIAL,
       SUBTAB.UNIT AS UNIDADE_MEDIDA,
       SUBTAB.ITEM_QUANTITY AS QTDE,
       SUBTAB.OPPORTUNITY_NO AS ID_OPORTUNIDADE,
       SUBTAB.COTACAO AS N_COTACAO,
       SUBTAB.CONTRATO_RECORRENTE AS N_CONTRATO,
       SUBTAB.TOTAL_VALUE_CALCULATED AS VALOR_BRUTO,
       SUBTAB.IMPOSTOS_INDIRETOS AS IMPOSTOS_INDIRETOS,
       SUBTAB.TOTAL_LIQUIDO AS VALOR_LIQUIDO,
       SUBTAB.COFINS_VALUE AS VALOR_COFINS,
       SUBTAB.PIS_VALUE AS VALOR_PIS,
       SUBTAB.CODENO_A AS ID_CODE_A_CONTA_CONTAB,
       SUBTAB.CODENO_B AS ID_CODE_B_CR,
       SUBTAB.CODENO_C AS ID_CODE_C_SITE,
       SUBTAB.CODENO_D AS ID_CODE_D_NATUREZA,
       SUBTAB.CODENO_E AS ID_CODE_E_ATIVO,
       SUBTAB.CODENO_F AS ID_CODE_F_PROJETO,
       IFSLAF.ACCOUNTING_CODE_PART_VALUE_API.GET_DESCRIPTION(SUBTAB.COMPANY, 'F', SUBTAB.CODENO_F) AS DESCR_CODE_F_PROJETO,
       SUBTAB.CODENO_G AS ID_CODE_G_LINHA,
       SUBTAB.CODENO_H AS ID_CODE_H_APR_CUSTO,
       SUBTAB.CODENO_I AS ID_CODE_I_NEGOCIO,
       SUBTAB.TIPO_LANCAMENTO,
       SUBTAB.USUARIO_INCLUSAO,
       SUBTAB.DATA_INCLUSAO,
       CAST(NULL AS VARCHAR2(20)) AS USUARIO_ULT_ALTERACAO,
       CAST(NULL AS DATE) AS DATA_ULT_ALTERACAO,
       SUBTAB.BLOCO_CODIGO
  FROM (SELECT NOTFIS.TIPO_MOVIMENTO,
               NOTFIS.FISCAL_NOTE_ID,
               NOTFIS.FISCAL_NOTE_NO,
               NOTFIS.INVOICE_ID,
               NOTFIS.N_TITULO,
               CAST(NULL AS NUMBER) AS VOUCHER_NO_REF,
               NOTFIS.TIPO_ORDEM,
               NOTFIS.ORDER_NO,
               NOTFIS.SALESMAN_NAME,
               NOTFIS.COD_VENDEDOR,
               NOTFIS.DOCUMENT_NO,
               NOTFIS.FISCAL_NOTE_TYPE,
               NOTFIS.DELIVERY_NAME,
               NOTFIS.DELIVERY_CNPJ_CPF,
               NOTFIS.CODIGO_CLIENTE,
               NOTFIS.IDENTITY_TYPE,
               NOTFIS.CREATION_DATE,
               NOTFIS.EMISSION_DATE,
               NOTFIS.ENTRY_DATE,
               NOTFIS.COMPANY,
               NOTFIS.CONTRACT,
               NOTFIS.CIDADE_OBRA,
               NOTFIS.ESTADO_OBRA,
               NOTFIS.OPERATION_ID,
               NOTFIS.ITEM_NUMBER,
               NOTFIS.PART_NO,
               NOTFIS.PRODUCT_DESCRIPTION,
               NOTFIS.ITEM_QUANTITY,
               NOTFIS.UNIT,
               NOTFIS.OPPORTUNITY_NO,
               NOTFIS.COTACAO,
               NOTFIS.CONTRATO_RECORRENTE,
               NOTFIS.UNITARY_GROSS_PRICE,
               NOTFIS.ITEM_TOTAL_VALUE,
               NOTFIS.TOTAL_VALUE_CALCULATED,
               NOTFIS.IMPOSTOS_INDIRETOS,
               NOTFIS.TOTAL_LIQUIDO,
               NOTFIS.COFINS_VALUE,
               NOTFIS.PIS_VALUE,
               NOTFIS.PRE_ACCOUNTING_ID,
               NOTFIS.CODENO_A,
               NOTFIS.CODENO_B,
               NOTFIS.CODENO_C,
               NOTFIS.CODENO_D,
               NOTFIS.CODENO_E,
               NOTFIS.CODENO_F,
               NOTFIS.CODENO_G,
               NOTFIS.CODENO_H,
               NOTFIS.CODENO_I,
               NOTFIS.OBSERVATION,
               'NORMAL' AS TIPO_LANCAMENTO,
               CAST(NULL AS VARCHAR2(20)) AS USUARIO_INCLUSAO,
               CAST(NULL AS DATE) AS DATA_INCLUSAO,
               'A' AS BLOCO_CODIGO
          FROM IFSINFO.LAF_NF_PRE_CONTABILIZADA NOTFIS
         UNION ALL
        SELECT 'FINANCEIRO',
               NULL AS FISCAL_NOTE_ID,
               NULL AS FISCAL_NOTE_NO,
               NULL AS INVOICE_ID,
               OMH.CF$_FISCAL_NOTE_NO,
               CAST(NULL AS NUMBER),
               OMH.CF$_ORDER_TYPE,
               NULL AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               NULL AS DOCUMENT_NO,
               OMH.CF$_FISCAL_NOTE_TYPE,
               OMH.CF$_DELIVERY_NAME,
               OMH.CF$_DELIVERY_CNPJ_CPF,
               NULL AS CODIGO_CLIENTE,
               OMH.CF$_IDENTITY_TYPE,
               OMH.CF$_CREATION_DATE,
               OMH.CF$_EMISSION_DATE,
               OMH.CF$_ENTRY_DATE,
               OMH.CF$_COMPANY,
               OMH.CF$_CONTRACT,
               NULL AS CIDADE_OBRA,
               NULL AS ESTADO_OBRA,
               NULL AS OPERATION_ID,
               NULL AS ITEM_NUMBER,
               NULL AS PART_NO,
               NULL AS PRODUCT_DESCRIPTION,
               1 AS ITEM_QUANTITY,
               'UN' AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               OMH.CF$_AGREEMENT_ID AS CONTRATO_RECORRENTE,
               OMH.CF$_TOTAL_VALUE_CALCULATED AS UNITARY_GROSS_PRICE,
               OMH.CF$_TOTAL_VALUE_CALCULATED AS ITEM_TOTAL_VALUE,
               OMH.CF$_TOTAL_VALUE_CALCULATED AS TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               OMH.CF$_TOTAL_VALUE_CALCULATED AS TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               NULL AS CODENO_A,
               OMH.CF$_CODE_B_CR,
               OMH.CF$_CODE_C_SITE,
               OMH.CF$_CODE_D_NATUREZA,
               NULL,
               NULL,
               OMH.CF$_CODE_G_LINHA,
               OMH.CF$_CODE_H_APR_CUSTO,
               NULL,
               NULL,
               'NORMAL',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'B'
          FROM IFSLAF.LAF_OMD_OMR_CLV OMH
         UNION ALL
        SELECT 'FINANCEIRO',
               FIN.INVOICE_ID,
               NULL,
               FIN.INVOICE_ID,
               FIN.INVOICE_NO,
               FIN.VOUCHER_NO_REF,
               NULL AS TIPO_ORDEM,
               FIN.PO_REF_NUMBER AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               FIN.LEDGER_ITEM_SERIES_ID AS DOCUMENT_NO,
               'Ord Compra' AS FISCAL_NOTE_TYPE,
               FIN.NAME AS DELIVERY_NAME,
               FIN.C_CNPJ AS DELIVERY_CNPJ_CPF,
               FIN.IDENTITY AS CODIGO_CLIENTE,
               IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(FIN.COMPANY, FIN.PAYER_IDENTITY, FIN.PARTY_TYPE) AS IDENTITY_TYPE,
               TRUNC(FIN.ARRIVAL_DATE) AS CREATION_DATE,
               TRUNC(FIN.LEDGER_DATE) AS EMISSION_DATE,
               TRUNC(FIN.ARRIVAL_DATE) AS ENTRY_DATE,
               FIN.COMPANY,
               FIN.CODE_C,
               NULL AS CIDADE_OBRA,
               NULL AS ESTADO_OBRA,
               NULL AS OPERATION_ID,
               NULL AS ITEM_NUMBER,
               NULL AS PART_NO,
               NULL AS PRODUCT_DESCRIPTION,
               NULL AS ITEM_QUANTITY,
               NULL AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               NULL AS CONTRATO_RECORRENTE,
               NULL AS UNITARY_GROSS_PRICE,
               NULL AS ITEM_TOTAL_VALUE,
               FIN.INV_AMOUNT AS TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               FIN.INV_AMOUNT AS TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               CAB.CODE_A,
               CAB.CODE_B,
               CAB.CODE_C,
               CAB.CODE_D,
               CAB.CODE_E,
               CAB.CODE_F,
               CAB.CODE_G,
               COALESCE(CAB.CODE_H, CAB.CODE_C),
               CAB.CODE_I,
               FIN.NOTE,
               'NORMAL',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'C'
          FROM IFSLAF.SUPP_INV_INTEREST_FINE_QRY FIN
         INNER JOIN IFSLAF.MAN_SUPP_INVOICE CAB ON (FIN.INVOICE_ID = CAB.INVOICE_ID AND FIN.COMPANY = CAB.COMPANY)
         WHERE (FIN.ADV_INV = 'FALSE')
           AND (FIN.CLIENT_INV_STATE <> 'Cancelado')
           AND (FIN.LEDGER_ITEM_SERIES_ID NOT IN ('AS', 'GF', 'GI', 'SX'))
           AND (FIN.PO_REF_NUMBER IS NULL)
           AND (CAB.INV_ACTUAL_NET_CURR_AMT > 0)
           AND (NVL(CAB.CODE_D, ' ') NOT IN ('1053', '1054', '1056', '1057', '1058', '1059', '1065', '1068', '1069', '1114', '1115'))
           AND (NOT (FIN.COMPANY IN ('41', '48', '54') AND FIN.IDENTITY = '34209835' AND FIN.LEDGER_ITEM_SERIES_ID = 'SI'))
         UNION ALL
        SELECT 'FINANCEIRO',
               NULL AS FISCAL_NOTE_ID,
               NULL AS FISCAL_NOTE_NO,
               NULL AS INVOICE_ID,
               FIN.REFERENCE_NUMBER,
               FIN.VOUCHER_NO_REFERENCE,
               NULL AS TIPO_ORDEM,
               NULL AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               FIN.REFERENCE_SERIE,
               'Ord Compra',
               FIN.PARTY_NAME,
               NULL,
               FIN.PARTY_TYPE_ID,
               IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(FIN.COMPANY, PARTY_TYPE_ID, 'Fornecedor'),
               TRUNC(FIN.VOUCHER_DATE),
               TRUNC(FIN.VOUCHER_DATE),
               TRUNC(FIN.VOUCHER_DATE),
               FIN.COMPANY,
               FIN.CODE_C,
               NULL AS CIDADE_OBRA,
               NULL AS ESTADO_OBRA,
               NULL AS OPERATION_ID,
               NULL AS ITEM_NUMBER,
               NULL AS PART_NO,
               NULL AS PRODUCT_DESCRIPTION,
               NULL AS ITEM_QUANTITY,
               NULL AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               NULL AS CONTRATO_RECORRENTE,
               NULL AS UNITARY_GROSS_PRICE,
               NULL AS ITEM_TOTAL_VALUE,
               FIN.AMOUNT AS TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               FIN.AMOUNT AS TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               FIN.ACCOUNT,
               FIN.CODE_B,
               FIN.CODE_C,
               FIN.CODE_D,
               FIN.CODE_E,
               FIN.CODE_F,
               FIN.CODE_G,
               FIN.CODE_H,
               FIN.CODE_I,
               FIN.TEXT,
               'NORMAL',
               FIN.USERID,
               FIN.ENTRY_DATE,
               'D'
          FROM IFSLAF.GEN_LED_VOUCHER_ROW_UNION_QRY FIN
         WHERE FIN.CODE_D IN ('1041', '1052', '1149', '1119', '1100', '1132', '1134', '1135', '1085', '1074')
           AND FIN.CORRECTED = 'N'
         UNION ALL
        SELECT 'FOLHA',
               NULL AS FISCAL_NOTE_ID,
               NULL AS FISCAL_NOTE_NO,
               NULL AS INVOICE_ID,
               NULL AS INVOICE_NO,
               NULL AS VOUCHER_NO_REF,
               NULL AS TIPO_ORDEM,
               NULL AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               NULL AS DOCUMENT_NO,
               'Ord Compra',
               FFH."NOME_FUNC",
               FFH."CNPJ_CPF_FUNC",
               CAST(FFH."CODIGO_FUNC" AS VARCHAR2(20)),
               'Externo',
               TO_DATE(FFH."DATA_COMPETENCIA",'RRRR/MM/DD'),
               TO_DATE(FFH."DATA_COMPETENCIA",'RRRR/MM/DD'),
               TO_DATE(FFH."DATA_COMPETENCIA",'RRRR/MM/DD'),
               IFSLAF.COMPANY_SITE_API.GET_COMPANY(SIT.CONTRACT),
               SIT.CONTRACT,
               NULL,
               NULL,
               NULL,
               NULL,
               CAST(FFH."RUBRICA" AS VARCHAR2(25)),
               RUB.CF$_DENOMINACAO_RUBRICA,
               1 AS ITEM_QUANTITY,
               'UN' AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               NULL AS CONTRATO_RECORRENTE,
               FFH."TOTAL_LIQUIDO" * CASE RUB.CF$_TIPO_RUBRICA_DB WHEN 'D' THEN -1 ELSE 1 END UNITARY_GROSS_PRICE,
               FFH."TOTAL_LIQUIDO" * CASE RUB.CF$_TIPO_RUBRICA_DB WHEN 'D' THEN -1 ELSE 1 END ITEM_TOTAL_VALUE,
               FFH."TOTAL_LIQUIDO" * CASE RUB.CF$_TIPO_RUBRICA_DB WHEN 'D' THEN -1 ELSE 1 END TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               FFH."TOTAL_LIQUIDO" * CASE RUB.CF$_TIPO_RUBRICA_DB WHEN 'D' THEN -1 ELSE 1 END TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               NULL AS CODENO_A,
               LOT.CF$_CODE_B,
               SIT.CONTRACT,
               RUB.CF$_CODE_D,
               NULL,
               RTRIM(LTRIM(FFH."CODENO_F")),
               NULL,
               LOT.CF$_CODE_H,
               CASE NVL(LOT.CF$_CODE_H, ' ')
                    WHEN '03' THEN CASE LOT.CF$_CODE_B WHEN '0025' THEN '03' ELSE '07' END
                    WHEN '09' THEN CASE LOT.CF$_CODE_B WHEN '0025' THEN '03' WHEN '0026' THEN '07'WHEN '0027' THEN '07'ELSE '01' END
                    WHEN '10' THEN CASE LOT.CF$_CODE_B WHEN '0025' THEN '03' WHEN '0026' THEN '07'WHEN '0027' THEN '07'ELSE '01' END
                    WHEN '11' THEN CASE LOT.CF$_CODE_B WHEN '0025' THEN '03' WHEN '0026' THEN '07'WHEN '0027' THEN '07'ELSE '01' END
                    WHEN '12' THEN '05'
                    WHEN '14' THEN '04'
                    WHEN '18' THEN '07'
                    WHEN '19' THEN '07'
                    WHEN '24' THEN '07'
                    WHEN '26' THEN '07'
                    WHEN '28' THEN '05'
                    WHEN '37' THEN '07'
                    WHEN '38' THEN '07'
                    WHEN '40' THEN '09'
                    WHEN '41' THEN '08'
                    WHEN '42' THEN '07'
                    WHEN '43' THEN '07'
                    WHEN '44' THEN '08'
                    WHEN '45' THEN '02'
                    WHEN '48' THEN '08'
                    WHEN '49' THEN '11'
                    WHEN '50' THEN '14'
                    WHEN '51' THEN '10'
                    WHEN '54' THEN '08'
                    ELSE CASE LOT.CF$_CODE_B WHEN '0002' THEN '01' END
               END,
               NULL,
               'NORMAL',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'E'
          FROM IFSLAF.LAF_FOLHA_HUMANUS FFH
         INNER JOIN IFSLAF.LAF_RUBRICAS_HUMANUS_CLV RUB ON (FFH."RUBRICA" = RUB.CF$_CODIGO_RUBRICA AND FFH."COD_MAO_OBRA" = RUB.CF$_MAO_OBRA_DB AND RUB.CF$_INCIDE_MATRIZ_DB = '1')
          LEFT JOIN IFSLAF.COMPANY_SITE_CFV SIT ON (FFH."COMPANY" || LPAD(CAST(FFH."SITE" AS NUMBER), 3, '0') = SIT.CF$_SITE_HUMANUS)
          LEFT JOIN IFSLAF.LAF_LOTACAO_HUMANUS_CLV LOT ON (SIT.CONTRACT = LOT.CF$_CONTRACT AND FFH."COD_LOTACAO" = LOT.CF$_CODIGO_LOTACAO)
         UNION ALL
        SELECT CASE NVL(CF$_TIPO_ACERTO_DB, 'D') WHEN 'R' THEN 'ENTRADA' ELSE 'SAÍDA' END AS TIPO_MOVIMENTO,
               ACG.CF$_FISCAL_NOTE_ID AS FISCAL_NOTE_ID,
               NULL AS FISCAL_NOTE_NO,
               ACG.CF$_ID_ACERTO AS INVOICE_ID,
               NULL AS INVOICE_NO,
               NULL AS VOUCHER_NO_REF,
               NULL AS TIPO_ORDEM,
               NULL AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               NULL AS DOCUMENT_NO,
               CASE NVL(CF$_TIPO_ACERTO_DB, 'D') WHEN 'R' THEN 'Ordem de Venda' ELSE 'Ord Compra' END AS FISCAL_NOTE_TYPE,
               NULL AS DELIVERY_NAME,
               NULL AS DELIVERY_CNPJ_CPF,
               NULL AS CODIGO_CLIENTE,
               NULL AS IDENTITY_TYPE,
               TRUNC(ACG.CF$_VOUCHER_DATE) AS CREATION_DATE,
               TRUNC(ACG.CF$_VOUCHER_DATE) AS EMISSION_DATE,
               TRUNC(ACG.CF$_VOUCHER_DATE) AS ENTRY_DATE,
               ACG.CF$_COMPANY AS COMPANY,
               ACG.CF$_CODE_C AS CONTRACT,
               NULL AS CIDADE_OBRA,
               NULL AS ESTADO_OBRA,
               NULL AS OPERATION_ID,
               NULL AS ITEM_NUMBER,
               NULL AS PART_NO,
               NULL AS PRODUCT_DESCRIPTION,
               1 AS ITEM_QUANTITY,
               'UN' AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               NULL AS CONTRATO_RECORRENTE,
               ACG.CF$_VALUE AS UNITARY_GROSS_PRICE,
               ACG.CF$_VALUE AS ITEM_TOTAL_VALUE,
               ACG.CF$_VALUE AS TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               ACG.CF$_VALUE AS TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               NULL AS CODENO_A,
               ACG.CF$_CODE_B,
               ACG.CF$_CODE_C,
               ACG.CF$_CODE_D,
               ACG.CF$_CODE_E,
               ACG.CF$_CODE_F,
               ACG.CF$_CODE_G,
               ACG.CF$_CODE_H,
               ACG.CF$_CODE_I,
               ACG.CF$_OBSERVACAO,
               'ACERTO',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'F'
          FROM IFSLAF.LAF_ACERTOS_GERENCIAIS_CLV ACG --ACERTOS GERENCIAIS
         WHERE ACG.CF$_FISCAL_NOTE_ID IS NULL
         UNION ALL
        SELECT NFE.TIPO_MOVIMENTO,
               NFE.FISCAL_NOTE_ID,
               NFE.FISCAL_NOTE_NO,
               NFE.INVOICE_ID,
               NFE.N_TITULO,
               NULL AS VOUCHER_NO_REF,
               NFE.TIPO_ORDEM,
               NFE.ORDER_NO,
               NFE.SALESMAN_NAME,
               NFE.COD_VENDEDOR,
               NFE.DOCUMENT_NO,
               NFE.FISCAL_NOTE_TYPE,
               NFE.DELIVERY_NAME,
               NFE.DELIVERY_CNPJ_CPF,
               NFE.CODIGO_CLIENTE,
               NFE.IDENTITY_TYPE,
               NFE.CREATION_DATE,
               NFE.EMISSION_DATE,
               NFE.ENTRY_DATE,
               NFE.COMPANY,
               NFE.CONTRACT,
               NFE.CIDADE_OBRA,
               NFE.ESTADO_OBRA,
               NFE.OPERATION_ID,
               NFE.ITEM_NUMBER,
               NFE.PART_NO,
               NFE.PRODUCT_DESCRIPTION,
               NFE.ITEM_QUANTITY,
               NFE.UNIT,
               NFE.OPPORTUNITY_NO,
               NFE.COTACAO,
               NFE.CONTRATO_RECORRENTE,
               NFE.UNITARY_GROSS_PRICE    * (-1) AS UNITARY_GROSS_PRICE,
               NFE.ITEM_TOTAL_VALUE       * (-1) AS ITEM_TOTAL_VALUE,
               NFE.TOTAL_VALUE_CALCULATED * (-1) AS TOTAL_VALUE_CALCULATED,
               NFE.IMPOSTOS_INDIRETOS     * (-1) AS IMPOSTOS_INDIRETOS,
               NFE.TOTAL_LIQUIDO          * (-1) AS TOTAL_LIQUIDO,
               NFE.COFINS_VALUE           * (-1) AS COFINS_VALUE,
               NFE.PIS_VALUE              * (-1) AS PIS_VALUE,
               NFE.PRE_ACCOUNTING_ID,
               NFE.CODENO_A,
               NFE.CODENO_B,
               NFE.CODENO_C,
               NFE.CODENO_D,
               NFE.CODENO_E,
               NFE.CODENO_F,
               NFE.CODENO_G,
               NFE.CODENO_H,
               NFE.CODENO_I,
               NFE.OBSERVATION,
               'ACERTO',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'G'
          FROM IFSINFO.LAF_NF_PRE_CONTABILIZADA NFE
         INNER JOIN (SELECT DISTINCT
                            A.CF$_FISCAL_NOTE_ID,
                            A.CF$_N_ITEM
                       FROM IFSLAF.LAF_ACERTOS_GERENCIAIS_CLV A) ACG ON (NFE.FISCAL_NOTE_ID = ACG.CF$_FISCAL_NOTE_ID AND NFE.ITEM_NUMBER = ACG.CF$_N_ITEM)
         UNION ALL
        SELECT NFE.TIPO_MOVIMENTO,
               NFE.FISCAL_NOTE_ID,
               NFE.FISCAL_NOTE_NO,
               NFE.INVOICE_ID,
               NFE.N_TITULO,
               NULL AS VOUCHER_NO_REF,
               NFE.TIPO_ORDEM,
               NFE.ORDER_NO,
               NFE.SALESMAN_NAME,
               NFE.COD_VENDEDOR,
               NFE.DOCUMENT_NO,
               NFE.FISCAL_NOTE_TYPE,
               NFE.DELIVERY_NAME,
               NFE.DELIVERY_CNPJ_CPF,
               NFE.CODIGO_CLIENTE,
               NFE.IDENTITY_TYPE,
               NFE.CREATION_DATE,
               NFE.EMISSION_DATE,
               NFE.ENTRY_DATE,
               NFE.COMPANY,
               NFE.CONTRACT,
               NFE.CIDADE_OBRA,
               NFE.ESTADO_OBRA,
               NFE.OPERATION_ID,
               NFE.ITEM_NUMBER,
               NFE.PART_NO,
               NFE.PRODUCT_DESCRIPTION,
               NFE.ITEM_QUANTITY,
               NFE.UNIT,
               NFE.OPPORTUNITY_NO,
               NFE.COTACAO,
               NFE.CONTRATO_RECORRENTE,
               CASE NVL(ACG.CF$_VALUE, 0) WHEN 0 THEN NFE.UNITARY_GROSS_PRICE ELSE ACG.CF$_VALUE / NFE.TOTAL_VALUE_CALCULATED * NFE.UNITARY_GROSS_PRICE END AS UNITARY_GROSS_PRICE,
               CASE NVL(ACG.CF$_VALUE, 0) WHEN 0 THEN NFE.ITEM_TOTAL_VALUE ELSE ACG.CF$_VALUE / NFE.TOTAL_VALUE_CALCULATED * NFE.ITEM_TOTAL_VALUE END AS ITEM_TOTAL_VALUE,
               NVL(ACG.CF$_VALUE, NFE.TOTAL_VALUE_CALCULATED) AS TOTAL_VALUE_CALCULATED,
               CASE NVL(ACG.CF$_VALUE, 0) WHEN 0 THEN NFE.IMPOSTOS_INDIRETOS ELSE ACG.CF$_VALUE / NFE.TOTAL_VALUE_CALCULATED * NFE.IMPOSTOS_INDIRETOS END AS IMPOSTOS_INDIRETOS,
               CASE NVL(ACG.CF$_VALUE, 0) WHEN 0 THEN NFE.TOTAL_LIQUIDO ELSE ACG.CF$_VALUE / NFE.TOTAL_VALUE_CALCULATED * NFE.TOTAL_LIQUIDO END AS TOTAL_LIQUIDO,
               CASE NVL(ACG.CF$_VALUE, 0) WHEN 0 THEN NFE.COFINS_VALUE ELSE ACG.CF$_VALUE / NFE.TOTAL_VALUE_CALCULATED * NFE.COFINS_VALUE END AS COFINS_VALUE,
               CASE NVL(ACG.CF$_VALUE, 0) WHEN 0 THEN NFE.PIS_VALUE ELSE ACG.CF$_VALUE / NFE.TOTAL_VALUE_CALCULATED * NFE.PIS_VALUE END AS PIS_VALUE,
               NFE.PRE_ACCOUNTING_ID,
               NFE.CODENO_A,
               NVL(ACG.CF$_CODE_B, NFE.CODENO_B),
               NVL(ACG.CF$_CODE_C, NFE.CODENO_C),
               NVL(ACG.CF$_CODE_D, NFE.CODENO_D),
               NVL(ACG.CF$_CODE_E, NFE.CODENO_E),
               NVL(ACG.CF$_CODE_F, NFE.CODENO_F),
               NVL(ACG.CF$_CODE_G, NFE.CODENO_G),
               NVL(ACG.CF$_CODE_H, NFE.CODENO_H),
               NVL(ACG.CF$_CODE_I, NFE.CODENO_I),
               NVL(ACG.CF$_OBSERVACAO, NFE.OBSERVATION),
               'ACERTO',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'H'
          FROM IFSINFO.LAF_NF_PRE_CONTABILIZADA NFE
         INNER JOIN IFSLAF.LAF_ACERTOS_GERENCIAIS_CLV ACG ON (NFE.FISCAL_NOTE_ID = ACG.CF$_FISCAL_NOTE_ID AND NFE.ITEM_NUMBER = ACG.CF$_N_ITEM)
         UNION ALL
        SELECT 'CONTABIL' AS TIPO_MOVIMENTO,
               NULL AS FISCAL_NOTE_ID,
               NULL AS FISCAL_NOTE_NO,
               NULL AS INVOICE_ID,
               NULL AS INVOICE_NO,
               NULL AS VOUCHER_NO_REF,
               NULL AS TIPO_ORDEM,
               NULL AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               NULL AS DOCUMENT_NO,
               'Ordem de Venda' AS FISCAL_NOTE_TYPE,
               A.PARTY_NAME AS DELIVERY_NAME,
               NULL AS DELIVERY_CNPJ_CPF,
               A.PARTY_TYPE_ID AS CODIGO_CLIENTE,
               COALESCE(IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(A.COMPANY, CASE A.ACCOUNT_TYPE WHEN 'REVENUES' THEN A.PARTY_TYPE_ID ELSE '' END, 'Cliente'), IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(A.COMPANY, CASE WHEN A.ACCOUNT_TYPE IN ('DESP', 'COST') THEN A.PARTY_TYPE_ID ELSE '' END, 'Fornecedor'), 'Externo') AS IDENTITY_TYPE,
               A.VOUCHER_DATE AS CREATION_DATE,
               A.VOUCHER_DATE AS EMISSION_DATE,
               A.VOUCHER_DATE AS ENTRY_DATE,
               A.COMPANY,
               A.CODE_C AS CONTRACT,
               NULL AS CIDADE_OBRA,
               NULL AS ESTADO_OBRA,
               NULL AS OPERATION_ID,
               NULL AS ITEM_NUMBER,
               A.VOUCHER_TYPE AS PART_NO,
               IFSLAF.VOUCHER_TYPE_API.GET_DESCRIPTION(A.COMPANY, A.VOUCHER_TYPE) AS PRODUCT_DESCRIPTION,
               1 AS ITEM_QUANTITY,
               'UN' AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               NULL AS CONTRATO_RECORRENTE,
               A.AMOUNT * (-1) AS UNITARY_GROSS_PRICE,
               A.AMOUNT * (-1) AS ITEM_TOTAL_VALUE,
               A.AMOUNT * (-1) AS TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               A.AMOUNT * (-1) AS TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               A.ACCOUNT,
               A.CODE_B,
               A.CODE_C,
               A.CODE_D,
               A.CODE_E,
               A.CODE_F,
               A.CODE_G,
               A.CODE_H,
               A.CODE_I,
               A.TEXT,
               'NORMAL',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'I'
          FROM IFSLAF.GEN_LED_VOUCHER_ROW_UNION_QRY A
         WHERE A.COMPANY = '41'
           AND A.ACCOUNT IN ('7110100001', '7110100002', '7110100003')
           AND A.VOUCHER_TYPE <> 'ENC'
         UNION ALL
        SELECT 'FINANCEIRO' AS TIPO_MOVIMENTO,
               FIN.INVOICE_ID AS FISCAL_NOTE_ID,
               NULL AS FISCAL_NOTE_NO,
               FIN.INVOICE_ID,
               FIN.INVOICE_NO,
               FIN.VOUCHER_NO_REF,
               NULL AS TIPO_ORDEM,
               NULL AS ORDER_NO,
               NULL AS SALESMAN_NAME,
               NULL AS COD_VENDEDOR,
               FIN.LEDGER_ITEM_SERIES_ID AS DOCUMENT_NO,
               'Ord Compra' AS FISCAL_NOTE_TYPE,
               FIN.NAME AS DELIVERY_NAME,
               FIN.C_CNPJ AS DELIVERY_CNPJ_CPF,
               FIN.IDENTITY AS CODIGO_CLIENTE,
               IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(FIN.COMPANY, FIN.PAYER_IDENTITY, FIN.PARTY_TYPE) AS IDENTITY_TYPE,
               TRUNC(CAB.VOUCHER_DATE_REF) AS CREATION_DATE,
               TRUNC(FIN.LEDGER_DATE) AS EMISSION_DATE,
               TRUNC(CAB.VOUCHER_DATE_REF) AS ENTRY_DATE,
               FIN.COMPANY,
               FIN.CODE_C AS CONTRACT,
               NULL AS CIDADE_OBRA,
               NULL AS ESTADO_OBRA,
               NULL AS OPERATION_ID,
               NULL AS ITEM_NUMBER,
               NULL AS PART_NO,
               NULL AS PRODUCT_DESCRIPTION,
               NULL AS ITEM_QUANTITY,
               NULL AS UNIT,
               NULL AS OPPORTUNITY_NO,
               NULL AS COTACAO,
               NULL AS CONTRATO_RECORRENTE,
               NULL AS UNITARY_GROSS_PRICE,
               NULL AS ITEM_TOTAL_VALUE,
               FIN.INV_AMOUNT * (-1) AS TOTAL_VALUE_CALCULATED,
               0.00 AS IMPOSTOS_INDIRETOS,
               FIN.INV_AMOUNT * (-1) AS TOTAL_LIQUIDO,
               0.00 AS COFINS_VALUE,
               0.00 AS PIS_VALUE,
               NULL AS PRE_ACCOUNTING_ID,
               CAB.CODE_A,
               CAB.CODE_B,
               CAB.CODE_C,
               CAB.CODE_D,
               CAB.CODE_E,
               CAB.CODE_F,
               CAB.CODE_G,
               COALESCE(CAB.CODE_H, CAB.CODE_C),
               CAB.CODE_I,
               FIN.NOTE,
               'NORMAL',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'J'
          FROM IFSLAF.CUST_INV_INTEREST_FINE_QRY FIN
         INNER JOIN IFSLAF.MAN_CUST_INVOICE CAB ON (FIN.INVOICE_ID = CAB.INVOICE_ID AND FIN.COMPANY = CAB.COMPANY)
         WHERE FIN.ADV_INV = 'FALSE' AND FIN.CLIENT_INV_STATE <> 'Cancelado' AND FIN.LEDGER_ITEM_SERIES_ID = 'NC' AND CAB.NET_AMOUNT > 0
         UNION ALL
        SELECT 'FINANCEIRO',
               FIN.INVOICE_ID,
               NULL,
               FIN.INVOICE_ID,
               FIN.INVOICE_NO,
               FIN.VOUCHER_NO_REF,
               NULL,
               FIN.PO_REF_NUMBER,
               NULL,
               NULL,
               FIN.LEDGER_ITEM_SERIES_ID,
               'Ord Compra',
               FIN.NAME,
               FIN.C_CNPJ,
               FIN.IDENTITY,
               IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(FIN.COMPANY, FIN.PAYER_IDENTITY, FIN.PARTY_TYPE),
               TRUNC(FIN.ARRIVAL_DATE),
               TRUNC(FIN.LEDGER_DATE),
               TRUNC(FIN.ARRIVAL_DATE),
               FIN.COMPANY,
               FIN.CODE_C,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               NULL,
               FIN.INV_AMOUNT,
               0.00,
               FIN.INV_AMOUNT,
               0.00,
               0.00,
               NULL,
               CAB.CODE_A,
               CAB.CODE_B,
               CAB.CODE_C,
               CAB.CODE_D,
               CAB.CODE_E,
               CAB.CODE_F,
               CAB.CODE_G,
               COALESCE(CAB.CODE_H, CAB.CODE_C),
               CAB.CODE_I,
               FIN.NOTE,
               'NORMAL',
               CAST(NULL AS VARCHAR2(20)),
               CAST(NULL AS DATE),
               'K'
          FROM IFSLAF.SUPP_INV_INTEREST_FINE_QRY FIN
         INNER JOIN IFSLAF.MAN_SUPP_INVOICE CAB ON (FIN.INVOICE_ID = CAB.INVOICE_ID AND FIN.COMPANY = CAB.COMPANY)
         WHERE CAB.INV_ACTUAL_NET_CURR_AMT > 0
           AND FIN.ADV_INV = 'FALSE'
           AND FIN.CLIENT_INV_STATE <> 'Cancelado'
           AND FIN.COMPANY IN ('41', '48', '54')
           AND FIN.IDENTITY = '34209835'
           AND FIN.LEDGER_ITEM_SERIES_ID = 'SI') SUBTAB
