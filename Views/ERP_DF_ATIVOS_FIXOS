SELECT 
    A.OBJECT_ID AS SERIAL,
    B.PART_NO AS ID_MATERIAL,
    B.PART_NO || '-' || A.CODE_C AS CHAVE_MATERIAL_SITE,
    A.DESCRIPTION AS DESC_MATERIAL,
    A.STATE AS STATUS_ATIVO,
    A.FA_OBJECT_TYPE AS TIPO_ATIVO,
    A.ACCOUNT AS ID_CONTA_AQUISICAO,
    IFSLAF.ACQUISITION_ACCOUNT_API.GET_DESCRIPTION(A.COMPANY, A.ACCOUNT) AS DESC_CONTA_AQUISICAO,
    A.ACQUISITION_DATE AS DATA_AQUISICAO,
    A.ACCOUNT AS ID_CODE_A_CONTA,
    A.CODE_B AS ID_CODE_B_CR,
    A.CODE_C AS ID_CODE_C_SITE,
    A.CODE_D AS ID_CODE_D_NATUREZA,
    A.CODE_F AS ID_CODE_E_PROJETO,
    A.CODE_G AS ID_CODE_G_LINHA,
    A.CODE_H AS ID_CODE_H_APR_CUSTO,
    A.CODE_I AS ID_CODE_I_PROJETO,
    A.LOCATION_DESCRIPTION AS DESC_LOCAL_ESTOQUE,
    COALESCE(B.CF$_STATUS_EQUIPMENT, 'Em Analise') AS STATUS_EQUIPAMENTO,
    COALESCE(B.CF$_LOCEQUIP, 'Em Analise') AS LOCAL_EQUIPAMENTO,
    COALESCE(B.CF$_STATUS_GERENCIAL, 'Em Analise') AS STATUS_GERENCIAL,
    COALESCE(B.CF$_ITERNALUSEFLAG, 'NÃO') AS USO_INTERNO,
    CASE B.CF$_SALE_STATUS_DB WHEN '2' THEN 'SIM' ELSE 'NÃO' END AS EXCLUSIVO_VENDA,
    C.VALOR_AQUISICAO / CASE WHEN A.ACQUISITION_DATE < DATE '2023-06-01' THEN (1 - 0.0925) ELSE 1 END AS VALOR_AQUISICAO,
    E.VALOR_BASE_CONTAB AS VALOR_BASE_CONTAB,
    E.VALOR_LIQUIDO AS VALOR_LIQUIDO,
    F.ESTIMATED_LIFE_CL AS VIDA_ESTIMADA,
    F.THRU_DATE AS DATA_FINAL,
    F.FULLY_DEPRECIATED AS TOTALMENTE_DEPRECIADO,
    F.EXCLUDE_FROM_DEPRECIATION AS EXCLUIR_DEPRECIACAO
FROM 
    IFSLAF.FA_OBJECT A
LEFT JOIN 
    IFSLAF.EQUIPMENT_SERIAL_CFV B ON A.OBJECT_ID = B.MCH_CODE AND A.COMPANY = B.COMPANY
LEFT JOIN 
    IFSLAF.FA_BOOK_PER_OBJECT F ON A.OBJECT_ID = F.OBJECT_ID AND F.BOOK_ID = 'CONTABIL' AND A.COMPANY = F.COMPANY
LEFT JOIN 
    (SELECT UBV.COMPANY, UBV.OBJECT_ID, UBV.VALUE AS VALOR_AQUISICAO
     FROM IFSLAF.USRDEFINED_BASE_VALUE UBV
     WHERE (UBV.COMPANY, UBV.OBJECT_ID, UBV.FROM_DATE) IN 
           (SELECT UBV1.COMPANY, UBV1.OBJECT_ID, MAX(UBV1.FROM_DATE) AS MAX_FROM_DATE
            FROM IFSLAF.USRDEFINED_BASE_VALUE UBV1
            GROUP BY UBV1.COMPANY, UBV1.OBJECT_ID)) C 
    ON A.COMPANY = C.COMPANY AND A.OBJECT_ID = C.OBJECT_ID
LEFT JOIN 
    (SELECT D.COMPANY, D.OBJECT_ID, 
                IFSLAF.FA_BOOK_PER_OBJECT_API.GET_BASE_VALUE_DEPR_CL(D.COMPANY, D.BOOK_ID, D.OBJECT_ID, TO_CHAR(SYSDATE, 'YYYY'), TO_CHAR(SYSDATE, 'MM'), 'FA', 'WITH_OR_WITHOUT_BOOK') AS VALOR_BASE_CONTAB,
                IFSLAF.FA_BOOK_PER_OBJECT_API.GET_NET_VALUE_AT_DATE(D.COMPANY, D.OBJECT_ID, D.BOOK_ID, TO_CHAR(SYSDATE, 'YYYY'), TO_CHAR(SYSDATE, 'MM'), 'FA', TRUNC(LAST_DAY(SYSDATE))) AS VALOR_LIQUIDO
     FROM IFSLAF.FA_OBJECT_SUM_METHODS2 D
     WHERE D.BOOK_ID = 'CONTABIL'
     ) E 
    ON A.COMPANY = E.COMPANY AND A.OBJECT_ID = E.OBJECT_ID
