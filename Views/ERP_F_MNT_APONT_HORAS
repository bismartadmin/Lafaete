SELECT SUBTAB.ID_SITE,
       IFSLAF.SITE_API.GET_DESCRIPTION(SUBTAB.ID_SITE) DESC_SITE,
       SUBTAB.ID_OS,
       SUBTAB.N_TAREFA_OS,
       SUBTAB.DESCR_TAREFA_OS,
       SUBTAB.STATUS_TAREFA_OS,
       SUBTAB.SERIAL,
       SUBTAB.ID_PARCEIRO,
       SUBTAB.DESC_PARCEIRO,
       SUBTAB.DESC_CIDADE,
       SUBTAB.DESC_SERIAL,
       SUBTAB.TIPO_OS,
       SUBTAB.GRUPO_RECURSO,
       SUBTAB.FUNCIONARIO,
       SUBTAB.DATA_INICIAL,
       SUBTAB.DATA_FINAL,
       SUBTAB.ID_TIPO_TEMPO,
       SUBTAB.DESC_TIPO_TEMPO,
       SUM(SUBTAB.HORAS) HORAS
  FROM (SELECT IFSLAF.HISTORICAL_SEPARATE_API.GET_CONTRACT(IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ)) ID_SITE,
               IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ) ID_OS,
               A.TASK_SEQ N_TAREFA_OS,
               IFSLAF.JT_TASK_API.GET_DESCRIPTION(A.TASK_SEQ) DESCR_TAREFA_OS,
               IFSLAF.WORK_ORDER_API.GET_STATE(IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ)) STATUS_TAREFA_OS,
               IFSLAF.WORK_ORDER_API.GET_MCH_CODE(IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ)) SERIAL,
               IFSLAF.JT_TASK_API.GET_CUSTOMER_NO(A.TASK_SEQ) ID_PARCEIRO,
               IFSLAF.CUSTOMER_INFO_API.GET_NAME(IFSLAF.JT_TASK_API.GET_CUSTOMER_NO(A.TASK_SEQ)) DESC_PARCEIRO,
               IFSLAF.CUSTOMER_ORDER_ADDRESS_API.GET_CITY(IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ)) DESC_CIDADE,
               IFSLAF.WORK_ORDER_API.GET_MCH_CODE_DESCRIPTION(IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ)) DESC_SERIAL,
               IFSLAF.WORK_ORDER_API.GET_WORK_TYPE_ID(IFSLAF.JT_TASK_API.GET_WO_NO(A.TASK_SEQ)) TIPO_OS,
               IFSLAF.RESOURCE_UTIL_API.GET_RESOURCE_DESCRIPTION(A.RESOURCE_GROUP_SEQ) GRUPO_RECURSO,
               IFSLAF.RESOURCE_UTIL_API.GET_RESOURCE_DESCRIPTION(A.RESOURCE_SEQ) FUNCIONARIO,
               A.C_START_DATE DATA_INICIAL,
               A.C_END_DATE DATA_FINAL,
               A.QUANTITY HORAS,
               A.time_type_id ID_TIPO_TEMPO,
               IFSLAF.WO_TIME_TYPE_API.Get_Time_Type_Desc(A.SITE,A.TIME_TYPE_ID) DESC_TIPO_TEMPO
          FROM IFSLAF.JT_TASK_TRANSACTION A
         WHERE A.C_START_DATE IS NOT NULL) SUBTAB
 WHERE (SUBTAB.GRUPO_RECURSO IS NOT NULL)
   AND (SUBTAB.FUNCIONARIO IS NOT NULL)
   --AND subtab.ID_OS = '256302'
 GROUP BY SUBTAB.ID_SITE,
          SUBTAB.ID_OS,
          SUBTAB.N_TAREFA_OS,
          SUBTAB.DESCR_TAREFA_OS,
          SUBTAB.STATUS_TAREFA_OS,
          SUBTAB.SERIAL,
          SUBTAB.ID_PARCEIRO,
          SUBTAB.DESC_PARCEIRO,
          SUBTAB.DESC_CIDADE,
          SUBTAB.DESC_SERIAL,
          SUBTAB.TIPO_OS,
          SUBTAB.GRUPO_RECURSO,
          SUBTAB.FUNCIONARIO,
          SUBTAB.DATA_INICIAL,
          SUBTAB.DATA_FINAL,
          SUBTAB.ID_TIPO_TEMPO,
       SUBTAB.DESC_TIPO_TEMPO
