SELECT B.COMPANY,
       A.INVOICE_ID,
       A.INVOICE_NO,
       B.ORDER_NO,
       B.CODE_B,
       B.CODE_C,
       B.CODE_D,
       B.CODE_E,
       B.CODE_F,
       B.CODE_G,
       B.CODE_H,
       B.CODE_I,
       B.CODE_J,
       NVL(IFSLAF.PURCHASE_ORDER_LINE_PART_API.GET_TOTAL_IN_ORDER_CURR(B.ORDER_NO,B.LINE_NO,B.RELEASE_NO),1) VALOR_LINHA,
       NVL(IFSLAF.PURCHASE_ORDER_API.CALC_ORDER_TOTAL_IN_ORDER_CURR(B.ORDER_NO),1)  VALOR_OC,
       NVL(IFSLAF.PURCHASE_ORDER_LINE_PART_API.GET_TOTAL_IN_ORDER_CURR(B.ORDER_NO,B.LINE_NO,B.RELEASE_NO),1)/NVL(IFSLAF.PURCHASE_ORDER_API.CALC_ORDER_TOTAL_IN_ORDER_CURR(B.ORDER_NO),1) PERCENT
FROM IFSLAF.MAN_SUPP_INVOICE A 
JOIN IFSLAF.PURCHASE_ORDER_LINE_PART B ON A.PO_REF_NUMBER = B.ORDER_NO-- AND a.LINE_no = b.line_no AND a.RELEASE_NO = b.REL_NO aND a.line_item_no = b.line_item_no 
WHERE NVL(IFSLAF.PURCHASE_ORDER_LINE_PART_API.GET_TOTAL_IN_ORDER_CURR(B.ORDER_NO,B.LINE_NO,B.RELEASE_NO),1) <> 0
AND A.ADV_INV = 'FALSE'
AND B.OBJSTATE <> 'Cancelled'
