SELECT A.FISCAL_NOTE_ID AS ID_NF,
       A.FISCAL_NOTE_NO AS NUM_NF,
       A.DOCUMENT_NO AS NUM_DOC,
       A.ADDRESSEE_TYPE AS TIPO_DESTINATARIO,
       A.ADDRESSEE_ID AS ID_DESTINATARIO,
       DECODE(A.ADDRESSEE_TYPE_DB,
              '1',
              SUBSTR(NVL(IFSLAF.SUPPLIER_ADDRESS_API.GET_COMPANY_NAME2(A.ADDRESSEE_ID, A.ADDRESSEE_ADDRESS_ID), IFSLAF.SUPPLIER_INFO_API.GET_NAME(A.ADDRESSEE_ID)), 1, 100),
              '2',
              SUBSTR(NVL(IFSLAF.CUSTOMER_INFO_ADDRESS_API.GET_NAME(A.ADDRESSEE_ID, A.ADDRESSEE_ADDRESS_ID), IFSLAF.CUSTOMER_INFO_API.GET_NAME(A.ADDRESSEE_ID)), 1, 100)) NOME_DESTINATARIO,
       IFSLAF.IDENTITY_INVOICE_INFO_API.GET_IDENTITY_TYPE(A.COMPANY, A.ADDRESSEE_ID, IFSLAF.CUSTOMER_INFO_API.GET_PARTY_TYPE(A.ADDRESSEE_ID)) AS TIPO_PARCEIRO,
       A.DELIVERY_ADDRESS_ID AS ID_DESTINO,
       A.OPERATION_ID AS ID_OPERACAO,
       IFSLAF.OPERATION_API.GET_DESCRIPTION(A.OPERATION_ID) AS OPERACAO_FISCAL,
       IFSLAF.INPUT_OUTPUT_TYPE_API.DECODE(A.INPUT_OUTPUT_TYPE_DB) AS DIRECAO_NF,
       A.CREATION_DATE AS DATA_CRIACAO,
       A.EMISSION_DATE AS DATA_EMISSAO,
       A.ENTRY_DATE AS DATA_LANCTO,
       CASE IFSLAF.INPUT_OUTPUT_TYPE_API.DECODE(A.INPUT_OUTPUT_TYPE_DB)
            WHEN 'Sa√≠da'    THEN IFSLAF.CUSTOMER_ORDER_API.GET_C_AGREEMENT_ID(IFSLAF.FN_CUST_PURC_ORDER_API.GET_ORDER_NO(B.FISCAL_NOTE_ID, B.ITEM_NUMBER))
            WHEN 'Entradas' THEN ifslaf.RETURN_MATERIAL_LINE_cfp.Get_Cf$_C_Agreement_Id(ifslaf.RETURN_MATERIAL_LINE_API.Get_Objkey(a.rma_no,b.RMA_LINE_NO))
       END AS CONTRATO_RECORRENTE,
       IFSLAF.FN_CUST_PURC_ORDER_API.GET_ORDER_NO(B.FISCAL_NOTE_ID, B.ITEM_NUMBER) AS ORDEM,
       B.ITEM_NUMBER AS NUM_ITEM,
       B.C_SERIAL_NO AS SERIAL,
       B.PART_NO AS COD_MATERIAL,
       B.PRODUCT_DESCRIPTION AS DES_MATERIAL,
       IFSLAF.COMMODITY_GROUP_API.GET_DESCRIPTION(IFSLAF.INVENTORY_PART_API.GET_SECOND_COMMODITY(A.CONTRACT, B.PART_NO)) AS LINHA_MATERIAL,
       IFSLAF.COMMODITY_GROUP_API.GET_DESCRIPTION(IFSLAF.INVENTORY_PART_API.GET_PRIME_COMMODITY(A.CONTRACT, B.PART_NO)) AS GRUPO_MATERIAL,

       A.CONTRACT AS SITE,
       B.UNITARY_GROSS_PRICE AS VALOR_UNITARIO
  FROM IFSLAF.FISCAL_NOTE A
 INNER JOIN IFSLAF.FISCAL_NOTE_ITEM B ON (A.FISCAL_NOTE_ID = B.FISCAL_NOTE_ID)
 WHERE (A.DOCUMENT_NO = '55')
   AND (A.STATE <> 'Cancelado')
   AND (EXISTS (SELECT 1 FROM IFSLAF.FA_OBJECT C WHERE C.OBJECT_ID = B.C_SERIAL_NO))
